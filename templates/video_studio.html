{% extends "base.html" %}
{% block content %}
<div class="max-w-6xl mx-auto" x-data="{ tab: 'upload', loading: false }">
    <div class="text-center mb-10">
        <h1 class="text-5xl md:text-7xl font-black mb-4 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500">
            Video Forge
        </h1>
        <p class="text-slate-400 text-lg">Turn static images into living cinematics.</p>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
        
        <div class="glass p-8 rounded-3xl border border-white/5 h-fit">
            
            <form hx-post="/video_studio" hx-target="#video-output" hx-encoding="multipart/form-data" @submit="loading = true" hx-on::after-request="loading = false">
                
                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 block">Source Image</label>
                    
                    <div id="drop-zone" class="border-2 border-dashed border-slate-600 rounded-2xl bg-slate-900/50 relative transition hover:border-purple-500 group min-h-[200px] flex flex-col items-center justify-center overflow-hidden">
                        
                        <input type="file" name="image_file" id="file-input" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-20" onchange="previewFile(this)">
                        
                        <div id="placeholder" class="text-center p-8 pointer-events-none transition duration-300">
                            <div class="text-5xl mb-3 opacity-50 group-hover:scale-110 transition">ðŸ“¤</div>
                            <h3 class="font-bold text-white mb-1">Click to Upload</h3>
                            <p class="text-xs text-slate-400">or Press <span class="bg-slate-700 px-1 rounded text-white">Ctrl + V</span> to Paste</p>
                        </div>

                        <div id="preview-container" class="absolute inset-0 w-full h-full bg-black hidden z-10">
                            <img id="img-preview" class="w-full h-full object-contain">
                            <button type="button" onclick="clearImage(event)" class="absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-500 shadow-lg z-30 font-bold transition">âœ•</button>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Motion Prompt</label>
                    <input type="text" name="prompt" placeholder="e.g. Glowing energy pulsing, smoke rising, camera zoom..." class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white outline-none focus:border-purple-500 transition font-medium">
                </div>

                <button class="w-full py-4 rounded-xl font-bold bg-white text-black hover:bg-purple-50 transition shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center justify-center gap-2" :disabled="loading">
                    <span x-show="!loading" class="flex items-center gap-2"><span class="text-xl">ðŸŽ¬</span> Generate Video</span>
                    <span x-show="loading" class="flex items-center gap-2">
                        <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        Rendering...
                    </span>
                </button>
            </form>
        </div>

        <div id="video-output" class="glass rounded-3xl border border-white/5 bg-black/40 flex items-center justify-center min-h-[400px]">
            <div x-show="!loading" class="text-center opacity-40">
                <div class="text-6xl mb-4 grayscale">ðŸŽ¥</div>
                <p class="font-bold">Result will appear here</p>
            </div>
            <div x-show="loading" class="text-center w-full px-10">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-pink-500 h-12 w-12 mx-auto mb-6 shadow-[0_0_15px_#ec4899]"></div>
                <h3 class="text-xl font-bold text-white mb-2">Dreaming in Motion...</h3>
                <p class="text-slate-400 text-sm">This typically takes 20-40 seconds.</p>
            </div>
        </div>

    </div>
</div>

<script>
    // --- PASTE & PREVIEW LOGIC ---
    
    // 1. Handle File Selection
    function previewFile(input) {
        if (input.files && input.files[0]) {
            showPreview(input.files[0]);
        }
    }

    // 2. Handle Paste (Ctrl+V)
    document.addEventListener('paste', function(event) {
        const items = (event.clipboardData || event.originalEvent.clipboardData).items;
        for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                const blob = items[i].getAsFile();
                
                // Create a container for the file to set it into the input
                const container = new DataTransfer();
                container.items.add(blob);
                document.getElementById('file-input').files = container.files;
                
                showPreview(blob);
                break;
            }
        }
    });

    // Helper: Show the image
    function showPreview(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('img-preview').src = e.target.result;
            document.getElementById('placeholder').classList.add('hidden');
            document.getElementById('preview-container').classList.remove('hidden');
        }
        reader.readAsDataURL(file);
    }

    // 3. Clear Image
    function clearImage(e) {
        e.preventDefault(); 
        e.stopPropagation(); // Stop clicking the file input behind button
        document.getElementById('file-input').value = ""; // Reset input
        document.getElementById('img-preview').src = "";
        document.getElementById('placeholder').classList.remove('hidden');
        document.getElementById('preview-container').classList.add('hidden');
    }
</script>

<style>.loader { border-top-color: #ec4899; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; } @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>
{% endblock %}
